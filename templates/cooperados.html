<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Cooperados - Coopex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts, Bootstrap e Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Roboto:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    :root{
      --bg:#191c20;
      --ink:#eaf2ff;          /* texto principal (quase branco) */
      --muted:#a9b7db;        /* textos secundarios */
      --gold:#ffd700;         /* destaque */
      --card1:#23262b;
      --card2:#003399;
      --thead:#1d2240;
      --rowOdd:#263155;
      --rowEven:#202a4a;
      --line:#2b3346;
      --field:#0f172a;        /* fundo inputs */
      --fieldBorder:#3b4565;
      --fieldFocus:#4b82ff;
    }

    body{
      background:var(--bg);
      font-family:Roboto, Arial, sans-serif;
      min-height:100vh;
      margin:0;
      color:var(--ink);
      text-shadow:none; /* sem blur global */
    }

    .main-container-flex{
      display:flex;
      flex-direction:row;
      align-items:flex-start;
      min-height:100vh;
      max-width:100vw;
      gap:24px;
      padding:24px 12px;
    }

    .main-content{
      width:100%;
      max-width:980px;
    }

    .dashboard-card{
      background:linear-gradient(120deg, var(--card1) 90%, var(--card2) 100%);
      border-radius:17px;
      box-shadow:0 8px 32px #0008, 0 2px 8px #00339944;
      padding:24px 18px 18px;
      margin-bottom:28px;
      color:var(--ink);
    }

    .dashboard-card h4{
      margin:0 0 14px 0;
      font-family:Orbitron, sans-serif;
      font-weight:700;
      letter-spacing:1.2px;
      color:var(--gold);
      text-shadow:0 1px 1px rgba(0,0,0,.55); /* leve e nítida */
    }

    /* Filtros */
    .filtros-row{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom:14px;
    }
    .filtros-row input[type="text"],
    .filtros-row input[type="number"]{
      border-radius:10px;
      border:1.5px solid var(--fieldBorder);
      padding:8px 14px;
      font-size:1.02rem;
      background:var(--field);
      color:var(--ink);
      max-width:260px;
    }
    .filtros-row input::placeholder{color:var(--muted);}
    .filtros-row input:focus{
      outline:none;
      border-color:var(--fieldFocus);
      box-shadow:0 0 0 .2rem rgba(75,130,255,.15);
    }
    .filtros-row input[type="number"]::-webkit-inner-spin-button,
    .filtros-row input[type="number"]::-webkit-outer-spin-button{
      -webkit-appearance:none; margin:0;
    }
    .form-check-label{ color:var(--ink); margin-left:7px; font-size:.96em; }

    /* Botões */
    .btn-primary{
      background:linear-gradient(90deg, var(--gold) 60%, #ffe670 100%);
      color:#191c20; font-weight:700; border:none; border-radius:14px;
    }
    .btn-primary:hover{ filter:brightness(1.06); }
    .btn-outline-primary{ color:#9ec0ff; border-color:#2d6cdf; }
    .btn-outline-primary:hover{ color:#eaf2ff; background:#2d6cdf22; border-color:#4b82ff; }
    .btn-outline-warning{ color:#ffdf7a; border-color:#e4b900; }
    .btn-outline-warning:hover{ color:#191c20; background:#ffd700; border-color:#ffd700; }
    .btn-outline-danger{ color:#ff9aa4; border-color:#e34b5a; }
    .btn-outline-danger:hover{ color:#ffe6e8; background:#e34b5a22; border-color:#ff7180; }

    /* Tabela */
    .table{ color:var(--ink); border-radius:10px; overflow:hidden; margin:0; }
    .table thead th{
      background:var(--thead);
      color:var(--gold) !important;
      font-family:Orbitron, sans-serif;
      letter-spacing:1.1px;
      text-align:center;
      border-bottom:1px solid var(--line);
    }
    .table tbody td{
      color:var(--ink);
      border-top:1px solid var(--line);
      text-shadow:none; /* nítido */
      vertical-align:middle;
      padding-top:12px; padding-bottom:12px;
    }
    .table-striped>tbody>tr:nth-of-type(odd)>*{ background-color:var(--rowOdd) !important; }
    .table-striped>tbody>tr:nth-of-type(even)>*{ background-color:var(--rowEven) !important; }
    .table-hover tbody tr:hover>*{ background-color:#2b375e !important; }

    .foto-cooperado{
      width:60px; height:60px; object-fit:cover;
      border-radius:50%; border:2.5px solid var(--gold);
      background:#101218; box-shadow:0 0 7px #00339944;
    }

    .txt-amarelo{ color:var(--gold) !important; font-weight:700; letter-spacing:.2px; text-shadow:none; }

    .alert{
      background:var(--gold); color:#222; font-weight:700; border-radius:9px;
      margin-bottom:10px; text-align:center;
    }

    @media (max-width:900px){
      .main-container-flex{ flex-direction:column; gap:14px; padding:14px 8px; }
      .dashboard-card{ padding:16px 10px; }
      .table thead th{ font-size:.9rem; }
      .table tbody td{ font-size:.95rem; }
      .foto-cooperado{ width:46px; height:46px; }
    }
  </style>
</head>
<body>
  <div class="main-container-flex">
    <div class="main-content">

      <!-- Voltar -->
      <a href="{{ url_for('dashboard') }}" class="btn btn-outline-light mb-3">
        <i class="bi bi-arrow-left-circle"></i> Voltar ao Dashboard
      </a>

      <div class="dashboard-card">
        <h4><i class="bi bi-people-fill"></i> Cooperados</h4>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} text-center">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- Filtros -->
        <div class="filtros-row">
          <input type="text" id="busca-cooperado" placeholder="Buscar por nome ou usuário…">
          <input type="number" step="0.01" min="0" id="filtro-credito" placeholder="Valor máximo de crédito" style="max-width:180px;">
          <div class="form-check form-switch" style="display:inline-flex;align-items:center;">
            <input class="form-check-input" type="checkbox" id="filtrar-diferente">
            <label class="form-check-label" for="filtrar-diferente">Mostrar apenas crédito diferente</label>
          </div>
          <a href="{{ url_for('novo_cooperado') }}" class="btn btn-primary btn-sm ms-auto">
            <i class="bi bi-person-plus"></i> Novo Cooperado
          </a>
        </div>

        <!-- Tabela -->
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle text-center" id="tabela-cooperados">
            <thead>
              <tr>
                <th>Foto</th>
                <th>Nome</th>
                <th>Usuário</th>
                <th>Crédito (R$)</th>
                <th style="width:160px">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for c in cooperados %}
              <tr>
                <td>
                  {% if c.foto_data or c.foto %}
                    <img src="{{ url_for('foto_cooperado', id=c.id) }}" alt="Foto de {{ c.nome }}" class="foto-cooperado" loading="lazy">
                  {% else %}
                    <span style="font-size:1.4em; color:var(--gold);"><i class="bi bi-person-circle"></i></span>
                  {% endif %}
                </td>
                <td class="txt-amarelo">{{ c.nome }}</td>
                <td>{{ c.username }}</td>
                <td class="txt-amarelo" data-credito="{{ "%.2f"|format(c.credito) }}">{{ "{:,.2f}".format(c.credito) }}</td>
                <td>
                  <a href="{{ url_for('editar_cooperado', id=c.id) }}" class="btn btn-outline-primary btn-sm">Editar</a>
                  <a href="{{ url_for('ajustar_credito_individual', id=c.id) }}" class="btn btn-outline-warning btn-sm">Ajustar Crédito</a>
                  <a href="{{ url_for('excluir_cooperado', id=c.id) }}" class="btn btn-outline-danger btn-sm"
                     onclick="return confirm('Excluir este cooperado?')">Excluir</a>
                </td>
              </tr>
              {% endfor %}
              {% if not cooperados %}
                <tr><td colspan="5" class="text-center">Nenhum cooperado cadastrado.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- (Calculadora removida conforme solicitado) -->
  </div>

  <script>
    // ====== Filtros cooperados (sem calculadora) ======
    function normalize(str){
      return (str || "").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();
    }

    function filtrarCooperados(){
      const busca = normalize(document.getElementById('busca-cooperado').value);
      const creditoFiltro = parseFloat((document.getElementById('filtro-credito').value || "").replace(",", "."));
      const filtrarDiferente = document.getElementById('filtrar-diferente').checked;
      const linhas = document.querySelectorAll("#tabela-cooperados tbody tr");
      let algumMostrado = false;

      linhas.forEach(linha=>{
        const nome = normalize(linha.cells[1]?.innerText);
        const usuario = normalize(linha.cells[2]?.innerText);
        const credito = parseFloat(linha.cells[3]?.getAttribute("data-credito"));
        let exibe = (!busca || nome.includes(busca) || usuario.includes(busca));
        if (!isNaN(creditoFiltro)){
          exibe = exibe && (filtrarDiferente ? (credito !== creditoFiltro) : (credito <= creditoFiltro));
        }
        linha.style.display = exibe ? "" : "none";
        if (exibe) algumMostrado = true;
      });

      const tabela = document.getElementById("tabela-cooperados");
      let noResult = tabela.querySelector(".no-result");
      if (!algumMostrado){
        if (!noResult){
          noResult = document.createElement("tr");
          noResult.className = "no-result";
          noResult.innerHTML = `<td colspan="5" class="text-center">Nenhum cooperado encontrado.</td>`;
          tabela.querySelector("tbody").appendChild(noResult);
        }
      } else if (noResult){
        noResult.remove();
      }
    }

    document.getElementById('busca-cooperado').addEventListener('input', filtrarCooperados);
    document.getElementById('filtro-credito').addEventListener('input', filtrarCooperados);
    document.getElementById('filtrar-diferente').addEventListener('change', filtrarCooperados);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
