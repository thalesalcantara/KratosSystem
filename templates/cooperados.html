<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cooperados - Coopex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts, Bootstrap e Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body {
            background: #191c20;
            font-family: 'Roboto', Arial, sans-serif;
            min-height: 100vh;
        }
        .main-content {
            margin: 0 auto;
            max-width: 880px;
            padding: 36px 12px 32px 12px;
        }
        .dashboard-card {
            background: linear-gradient(120deg, #23262b 90%, #003399 100%);
            border-radius: 17px;
            box-shadow: 0 8px 32px #0008, 0 2px 8px #00339944;
            padding: 28px 24px 20px 24px;
            margin-bottom: 38px;
            color: #ffd700;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 4px #222, 0 1px 2px #00339988;
        }
        .dashboard-card h4 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: #fff;
            letter-spacing: 1.5px;
        }
        .filtros-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 14px;
        }
        .filtros-row input[type="text"], .filtros-row input[type="number"] {
            border-radius: 10px;
            border: none;
            padding: 7px 14px;
            font-size: 1.08em;
            background: #23262b;
            color: #ffd700;
            font-family: 'Roboto', Arial, sans-serif;
            max-width: 220px;
            margin-right: 8px;
        }
        .filtros-row input[type="number"]::-webkit-inner-spin-button, 
        .filtros-row input[type="number"]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        .form-check-label { color: #fff; margin-left: 7px; }
        .btn-primary {
            background: linear-gradient(90deg,#ffd700 60%,#ffe670 100%);
            color: #191c20;
            font-weight: bold;
            border: none;
            border-radius: 17px;
            transition: background .17s;
        }
        .btn-primary:hover {
            background: #ffe670;
            color: #003399;
        }
        .table {
            color: #fff;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
        }
        .table thead th {
            background: #22263d;
            color: #ffd700;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1.1px;
        }
        .table-striped>tbody>tr:nth-of-type(odd)>* {
            background-color: #1d2024 !important;
            color: #ffd700 !important;
            text-shadow: 0 0 3px #ffd700;
        }
        .table-striped>tbody>tr:nth-of-type(even)>* {
            background-color: #1a1d21 !important;
            color: #ffd700 !important;
            text-shadow: 0 0 3px #ffd700;
        }
        .foto-cooperado {
            width: 60px; height: 60px; object-fit: cover;
            border-radius: 50%; border: 2.5px solid #ffd700;
            background: #101218; box-shadow: 0 0 7px #00339944;
        }
        .txt-amarelo { color: #ffd700 !important; font-weight: 600; letter-spacing: .4px; text-shadow: 0 0 3px #ffd700; }

        /* ----------- CALCULADORA ----------- */
        .calculadora-box {
            background: #23262b;
            border-radius: 13px;
            box-shadow: 0 3px 12px #00339933;
            padding: 18px 22px 14px 22px;
            color: #ffd700;
            max-width: 270px;
            margin: 0 auto 28px auto;
            font-family: 'Roboto', Arial, sans-serif;
        }
        .calculadora-titulo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.17em;
            font-weight: 700;
            color: #ffd700;
            text-align: center;
            margin-bottom: 8px;
        }
        .calculadora-display {
            width: 100%;
            background: #101218;
            color: #ffd700;
            font-size: 1.4em;
            font-family: 'Orbitron', monospace;
            border: 1.5px solid #00339966;
            border-radius: 8px;
            margin-bottom: 11px;
            padding: 6px 10px;
            text-align: right;
        }
        .calculadora-botoes {
            display: grid;
            grid-template-columns: repeat(4, 50px);
            gap: 7px;
            justify-content: center;
        }
        .calc-btn {
            font-size: 1.15em;
            font-family: 'Orbitron', monospace;
            border-radius: 7px;
            border: none;
            background: #003399;
            color: #ffd700;
            font-weight: bold;
            padding: 10px 0;
            cursor: pointer;
            transition: background 0.13s;
        }
        .calc-btn:active, .calc-btn:hover {
            background: #ffd700;
            color: #003399;
        }
        .calc-btn.operador { background: #23262b; color: #ffd700; border: 1.5px solid #00339955;}
        .calc-btn.igual { background: #ffd700; color: #003399;}
        .calc-btn.limpar { background: #d9534f; color: #fff;}
        @media (max-width: 700px) {
            .main-content { padding: 7px 2px; }
            .dashboard-card { padding: 10px 3px 5px 3px; }
            .foto-cooperado { width: 38px; height: 38px; }
            .filtros-row { flex-direction: column; align-items: stretch; gap: 8px; }
            .calculadora-box { max-width: 100%; }
            .calculadora-botoes { grid-template-columns: repeat(4, 1fr);}
        }
    </style>
</head>
<body>
    <div class="main-content">
        <!-- CALCULADORA -->
        <div class="calculadora-box mb-4">
            <div class="calculadora-titulo"><i class="bi bi-calculator"></i> Calculadora</div>
            <input type="text" class="calculadora-display" id="calc-display" readonly value="0">
            <div class="calculadora-botoes">
                <button class="calc-btn" onclick="calcInsere('7')">7</button>
                <button class="calc-btn" onclick="calcInsere('8')">8</button>
                <button class="calc-btn" onclick="calcInsere('9')">9</button>
                <button class="calc-btn operador" onclick="calcInsere('/')">÷</button>
                <button class="calc-btn" onclick="calcInsere('4')">4</button>
                <button class="calc-btn" onclick="calcInsere('5')">5</button>
                <button class="calc-btn" onclick="calcInsere('6')">6</button>
                <button class="calc-btn operador" onclick="calcInsere('*')">×</button>
                <button class="calc-btn" onclick="calcInsere('1')">1</button>
                <button class="calc-btn" onclick="calcInsere('2')">2</button>
                <button class="calc-btn" onclick="calcInsere('3')">3</button>
                <button class="calc-btn operador" onclick="calcInsere('-')">−</button>
                <button class="calc-btn" onclick="calcInsere('0')">0</button>
                <button class="calc-btn" onclick="calcInsere('.')">.</button>
                <button class="calc-btn limpar" onclick="calcLimpar()">C</button>
                <button class="calc-btn operador" onclick="calcInsere('+')">+</button>
                <button class="calc-btn igual" onclick="calcResultado()" style="grid-column: span 4;">=</button>
            </div>
        </div>
        <!-- FIM CALCULADORA -->

        <div class="dashboard-card">
            <h4><i class="bi bi-people-fill"></i> Cooperados</h4>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} text-center">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="filtros-row">
                <input type="text" id="busca-cooperado" placeholder="Buscar por nome ou usuário...">
                <input type="number" step="0.01" min="0" id="filtro-credito" placeholder="Valor máximo de crédito" style="max-width: 140px;">
                <div class="form-check form-switch" style="display:inline-flex;align-items:center;">
                    <input class="form-check-input" type="checkbox" id="filtrar-diferente">
                    <label class="form-check-label" for="filtrar-diferente" style="font-size:0.96em;">Mostrar apenas crédito diferente</label>
                </div>
                <a href="{{ url_for('novo_cooperado') }}" class="btn btn-primary btn-sm ms-auto">
                    <i class="bi bi-person-plus"></i> Novo Cooperado
                </a>
            </div>
            <div class="table-responsive">
                <table class="table table-striped align-middle text-center" id="tabela-cooperados">
                    <thead>
                        <tr>
                            <th>Foto</th>
                            <th>Nome</th>
                            <th>Usuário</th>
                            <th>Crédito (R$)</th>
                            <th style="width:160px">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for c in cooperados %}
                        <tr>
                            <td>
                                {% if c.foto %}
                                    <img src="{{ url_for('static', filename='uploads/' ~ c.foto) }}" alt="Foto de {{ c.nome }}" class="foto-cooperado">
                                {% else %}
                                    <span style="font-size:1.4em; color:#ffd700;">
                                        <i class="bi bi-person-circle"></i>
                                    </span>
                                {% endif %}
                            </td>
                            <td class="txt-amarelo">{{ c.nome }}</td>
                            <td class="txt-amarelo">{{ c.username }}</td>
                            <td class="txt-amarelo" data-credito="{{ "%.2f"|format(c.credito) }}">{{ "{:,.2f}".format(c.credito) }}</td>
                            <td>
                                <a href="{{ url_for('editar_cooperado', id=c.id) }}" class="btn btn-outline-primary btn-sm">Editar</a>
                                <a href="{{ url_for('ajustar_credito_individual', id=c.id) }}" class="btn btn-outline-warning btn-sm">Ajustar Crédito</a>
                                <a href="{{ url_for('excluir_cooperado', id=c.id) }}" class="btn btn-outline-danger btn-sm"
                                    onclick="return confirm('Excluir este cooperado?')">Excluir</a>
                            </td>
                        </tr>
                    {% endfor %}
                    {% if not cooperados %}
                        <tr><td colspan="5" class="text-center">Nenhum cooperado cadastrado.</td></tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
    // ---- CALCULADORA JS ----
    let calcValor = '';
    function calcInsere(val) {
        if (calcValor === '' && (val === '*' || val === '/' || val === '+' || val === '-')) return;
        if (calcValor.length > 20) return;
        calcValor += val;
        document.getElementById('calc-display').value = calcValor;
    }
    function calcResultado() {
        try {
            if (calcValor === '') return;
            let res = eval(calcValor.replace(/[^-()\d/*+.]/g, ''));
            if (res === undefined) return;
            document.getElementById('calc-display').value = res;
            calcValor = res.toString();
        } catch (e) {
            document.getElementById('calc-display').value = 'Erro';
            calcValor = '';
        }
    }
    function calcLimpar() {
        calcValor = '';
        document.getElementById('calc-display').value = '0';
    }
    // ---- FIM CALCULADORA JS ----

    // Filtros cooperados
    function normalize(str) {
        return (str || "")
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "")
            .toLowerCase();
    }
    function filtrarCooperados() {
        const busca = normalize(document.getElementById('busca-cooperado').value);
        const creditoFiltro = parseFloat(document.getElementById('filtro-credito').value.replace(",", "."));
        const filtrarDiferente = document.getElementById('filtrar-diferente').checked;
        const linhas = document.querySelectorAll("#tabela-cooperados tbody tr");
        let algumMostrado = false;

        linhas.forEach(linha => {
            const nome = normalize(linha.cells[1]?.innerText);
            const usuario = normalize(linha.cells[2]?.innerText);
            const credito = parseFloat(linha.cells[3]?.getAttribute("data-credito"));
            let exibe = (!busca || nome.includes(busca) || usuario.includes(busca));
            if (!isNaN(creditoFiltro)) {
                if (filtrarDiferente) {
                    exibe = exibe && (credito !== creditoFiltro);
                } else {
                    exibe = exibe && (credito <= creditoFiltro);
                }
            } else if (filtrarDiferente) {
                exibe = exibe && true;
            }
            linha.style.display = exibe ? "" : "none";
            if (exibe) algumMostrado = true;
        });

        const tabela = document.getElementById("tabela-cooperados");
        let noResult = tabela.querySelector(".no-result");
        if (!algumMostrado) {
            if (!noResult) {
                noResult = document.createElement("tr");
                noResult.className = "no-result";
                noResult.innerHTML = `<td colspan="5" class="text-center">Nenhum cooperado encontrado.</td>`;
                tabela.querySelector("tbody").appendChild(noResult);
            }
        } else if (noResult) {
            noResult.remove();
        }
    }

    document.getElementById('busca-cooperado').addEventListener('input', filtrarCooperados);
    document.getElementById('filtro-credito').addEventListener('input', filtrarCooperados);
    document.getElementById('filtrar-diferente').addEventListener('change', filtrarCooperados);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
