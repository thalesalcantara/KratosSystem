<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Painel do Cooperado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Fonte opcional -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --royal:#0d3ccf;
      --royal-600:#0b31a9;
      --royal-50:#e9f0ff;
      --ink:#111827;
      --muted:#6b7280;
      --ok:#13b981;
      --bg:#f6f8ff;
      --card:#ffffff;
      --line:#eef2ff;
      --chip:#edf2ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* Topbar */
    header{
      position:sticky; top:0; z-index:20;
      background:linear-gradient(110deg, var(--royal), var(--royal-600));
      color:#fff; padding:14px 16px; display:flex; align-items:center; gap:12px;
      box-shadow:0 6px 16px rgba(0,0,0,.18);
    }
    .avatar{
      width:44px; height:44px; border-radius:50%; object-fit:cover; background:#fff2; border:2px solid #ffffff44;
    }
    .title{margin:0; font-weight:800; font-size:18px; line-height:1.1}
    .subtitle{margin:2px 0 0 0; font-size:12px; opacity:.9}
    .spacer{flex:1}
    .logout{
      color:#fff; text-decoration:none; font-weight:700; font-size:13px;
      border:1px solid #ffffff66; padding:6px 10px; border-radius:10px;
    }
    .logout:hover{background:#ffffff1a}

    .wrap{max-width:1100px; margin:16px auto; padding:0 12px}

    /* Cards métricas */
    .grid{display:grid; gap:12px; grid-template-columns: repeat(12, 1fr)}
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:16px; padding:14px;
      box-shadow:0 10px 22px rgba(17,24,39,.04);
    }
    .card h3{margin:0 0 8px 0; font-size:14px; color:#111827}
    .metric{font-size:28px; font-weight:800}
    .metric.ok{color:var(--ok)}
    .muted{color:var(--muted)}
    .badge{background:var(--chip); color:var(--royal); font-weight:800; padding:4px 10px; border-radius:999px; font-size:12px}

    /* Filtros */
    .filters{display:flex; gap:10px; flex-wrap:wrap; align-items:end; margin:8px 0 12px}
    .filters .field{display:flex; flex-direction:column; gap:6px}
    .filters label{font-size:12px; color:#374151; font-weight:600}
    .filters input[type="date"]{
      padding:10px 12px; height:42px; border:1px solid var(--line); border-radius:12px; background:#fff;
    }
    .filters button{
      height:42px; padding:0 16px; border:0; border-radius:12px; font-weight:800; color:#fff;
      background:linear-gradient(90deg, var(--royal), var(--royal-600)); cursor:pointer;
    }
    .filters a.reset{
      height:42px; display:inline-flex; align-items:center; justify-content:center; padding:0 14px;
      border-radius:12px; font-weight:700; color:var(--royal-600); background:#e9f0ff; text-decoration:none;
      border:1px solid var(--line);
    }

    /* Tabela */
    .table-wrap{overflow:auto; border:1px solid var(--line); border-radius:14px}
    table{width:100%; border-collapse:collapse}
    th, td{padding:12px 10px; border-bottom:1px solid var(--line); font-size:14px}
    thead th{
      position:sticky; top:0; background:#f8faff; text-transform:uppercase; letter-spacing:.06em;
      font-size:12px; color:#4b5563; text-align:left;
    }
    td.right{text-align:right}
    tr:hover td{background:#fbfdff}
    .empty{padding:18px; color:var(--muted); text-align:center}

    /* Responsivo */
    @media (max-width: 900px){
      .grid .span-4{grid-column: span 12}
      .grid .span-12{grid-column: span 12}
      .metric{font-size:24px}
    }
    @media (min-width: 901px){
      .grid .span-4{grid-column: span 4}
      .grid .span-12{grid-column: span 12}
    }
  </style>
</head>
<body>

<header>
  <img class="avatar" src="{{ url_for('foto_cooperado', id=coop.id) }}" alt="foto do cooperado" onerror="this.style.visibility='hidden'">
  <div>
    <h1 class="title">Olá, {{ coop.nome }}</h1>
    <div class="subtitle">Usuário: <b>@{{ coop.username }}</b></div>
  </div>
  <div class="spacer"></div>
  <a class="logout" href="{{ url_for('logout') }}">Sair</a>
</header>

<div class="wrap">
  <!-- Métricas -->
  <div class="grid">
    <div class="card span-4">
      <h3>Crédito disponível</h3>
      <div class="metric ok">R$ {{ '%.2f'|format(coop.credito or 0) }}</div>
      {% if coop.credito_atualizado_em %}
        <div class="muted" style="margin-top:6px">Último ajuste: {{ coop.credito_atualizado_em.strftime('%d/%m/%Y %H:%M') }}</div>
      {% else %}
        <div class="muted" style="margin-top:6px">Sem ajustes manuais registrados</div>
      {% endif %}
    </div>

    <div class="card span-4">
      <h3>Total de lançamentos (período)</h3>
      <div class="metric">{{ total_lanc }}</div>
      <div class="muted" style="margin-top:6px">Itens listados abaixo</div>
    </div>

    <div class="card span-4">
      <h3>Gasto no período</h3>
      <div class="metric">R$ {{ '%.2f'|format(total_gasto or 0) }}</div>
      <div class="muted" style="margin-top:6px">Soma dos lançamentos filtrados</div>
    </div>

    <div class="card span-12">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px">
        <h3 style="margin:0">Meus lançamentos</h3>
        <span class="badge">Atualizado agora</span>
      </div>

      <form class="filters" method="get" action="{{ url_for('painel_cooperado') }}">
        <div class="field">
          <label for="di">Data início</label>
          <input id="di" type="date" name="data_inicio" value="{{ data_inicio }}">
        </div>
        <div class="field">
          <label for="df">Data fim</label>
          <input id="df" type="date" name="data_fim" value="{{ data_fim }}">
        </div>
        <div class="field">
          <button type="submit">Aplicar filtros</button>
        </div>
        {% if data_inicio or data_fim %}
        <a class="reset" href="{{ url_for('painel_cooperado') }}">Limpar</a>
        {% endif %}
      </form>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Nº OS</th>
              <th>Estabelecimento</th>
              <th class="right">Valor (R$)</th>
              <th>Descrição</th>
            </tr>
          </thead>
          <tbody>
            {% if lancamentos %}
              {% for l in lancamentos %}
              <tr>
                <td>{{ l.data_brasilia or l.data.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ l.os_numero }}</td>
                <td>{{ l.estabelecimento.nome if l.estabelecimento else '-' }}</td>
                <td class="right">{{ '%.2f'|format(l.valor or 0) }}</td>
                <td>{{ l.descricao or '' }}</td>
              </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="5" class="empty">Nenhum lançamento neste período.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <div class="muted" style="margin-top:10px">* Os horários são mostrados em Brasília (GMT-3).</div>
    </div>
  </div>
</div>

</body>
</html>
