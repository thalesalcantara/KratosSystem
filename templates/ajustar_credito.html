<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>
    {% if cooperado %}Ajustar Crédito - {{ cooperado.nome }}{% else %}Ajustar Crédito{% endif %}
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <style>
    body{background:#191c20;font-family:'Roboto',Arial,sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
    .ajustar-card{background:#23262b;color:#ffd700;padding:36px 28px 24px;border-radius:16px;box-shadow:0 8px 32px #000a;width:100%;max-width:460px}
    .titulo{font-family:'Orbitron',sans-serif;letter-spacing:1.3px;color:#fff;text-align:center;margin-bottom:14px}
    .foto-cooperado{width:90px;height:90px;object-fit:cover;border-radius:50%;border:3px solid #ffd700;margin:10px auto;background:#fff;display:block;box-shadow:0 0 8px #00339955}
    .nome{color:#fff;text-align:center;margin-bottom:8px;font-weight:600}
    label{color:#fff;font-weight:600}
    .form-control{background:#23262b;border:1px solid #22263d;color:#ffd700;font-weight:500;border-radius:9px}
    .form-control:focus{border-color:#ffd700;box-shadow:0 0 0 1.5px #ffd70044;background:#191c20;color:#ffd700}
    .btn-primary{background:linear-gradient(90deg,#ffd700 60%,#ffe670 100%);color:#191c20;font-weight:bold;border:none;border-radius:13px;width:100%;margin-top:10px}
    .btn-primary:hover{background:#ffe670;color:#003399}
    .btn-outline-warning{border-radius:13px}
    .alert{background:#ffd700;color:#222;font-weight:600;border-radius:9px;margin-bottom:12px}
    .linha-btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  </style>
</head>
<body>
  <div class="ajustar-card">

    {% if session.get('user_tipo') == 'admin' %}
      <div class="mb-2">
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-warning btn-sm">
          <i class="bi bi-arrow-left"></i> Voltar ao Dashboard
        </a>
      </div>
    {% endif %}

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if cooperado %}
      <!-- MODO INDIVIDUAL -->
      <h4 class="titulo"><i class="bi bi-cash-coin"></i> Ajustar Crédito</h4>

      {% if cooperado.foto_data or cooperado.foto %}
        <img src="{{ url_for('foto_cooperado', id=cooperado.id) }}"
             alt="Foto de {{ cooperado.nome }}" class="foto-cooperado">
      {% else %}
        <div class="text-center" style="font-size:2rem;color:#ffd700;">
          <i class="bi bi-person-circle"></i>
        </div>
      {% endif %}

      <div class="nome">{{ cooperado.nome }}</div>
      <div class="text-center mb-2" style="color:#ffe670;">
        Crédito atual: <strong>R$ {{ '%.2f'|format(cooperado.credito) }}</strong>
      </div>

      <form method="post">
        <label for="credito">Novo crédito (R$):</label>
        <input type="number" name="credito" id="credito" class="form-control"
               value="{{ '%.2f'|format(cooperado.credito) }}" min="0" step="0.01" required>
        <div class="linha-btns">
          <button type="submit" class="btn btn-primary">Salvar</button>
          <a href="{{ url_for('listar_cooperados') }}" class="btn btn-secondary flex-fill">
            <i class="bi bi-people"></i> Voltar à lista
          </a>
        </div>
      </form>

    {% else %}
      <!-- MODO GLOBAL (seleciona cooperado) -->
      <h4 class="titulo"><i class="bi bi-cash-coin"></i> Ajustar Crédito</h4>

      <form method="post">
        <div class="mb-3">
          <label for="cooperado_id"><i class="bi bi-person-badge"></i> Cooperado</label>
          <select class="form-control" id="cooperado_id" name="cooperado_id" required>
            <option value="" disabled selected>Selecione…</option>
            {% for c in cooperados %}
              <option value="{{ c.id }}">{{ c.nome }} — ({{ c.username }}) — R$ {{ '%.2f'|format(c.credito) }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-2">
          <label for="credito"><i class="bi bi-currency-dollar"></i> Novo crédito (R$)</label>
          <input type="number" class="form-control" id="credito" name="credito" min="0" step="0.01" required>
        </div>

        <div class="linha-btns">
          <button type="submit" class="btn btn-primary">Salvar</button>
          <a href="{{ url_for('listar_cooperados') }}" class="btn btn-secondary flex-fill">
            <i class="bi bi-people"></i> Voltar à lista
          </a>
        </div>
      </form>
    {% endif %}

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
